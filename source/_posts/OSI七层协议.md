---
title: OSI七层协议
date: 2021-07-04 02:18:33.0
updated: 2021-11-09 03:25:54.828
url: /?p=32
categories: 
- 计算机网络
tags: 
- 计算机网络
- OSI
---

## 计算机网络: OSI七层协议和各种协议介绍

+ 了解osi模型可以更清晰掌握数据在网络中的各个层次运输的过程
+ OSI七层模型也是面试的热点,从中可以引申出大量的相关知识
+ 另外, 各层次的代表协议和硬件, TCP四层模型也是相当重要的

### 1. 什么事OSI七层模型

开放式系统互联模型(open system interconnection model), 缩写OSI, 是一个概念模型,一个试图使计算机在世界范围内互联为网络的标准框架, 定义与ISO/IEC 7498-1

> 概念不重要,最重要的是理解好隔层的含义和对应的典型协议应用

OSI七层协议自上而下分别是:

+ 应用层
+ 表示层
+ 回话层
+ 传输层
+ 网络层
+ 数据链路层
+ 物理层

### 2. OSI模型各层次介绍

![8031371-5a9bedfe0cc8613d](https://i.loli.net/2021/09/14/wUJQe6S5mMILGFK.png)

#### 物理层

+ 物理层通过媒介传输比特,确定机械以及电气规范, eg: 集线器;
+ 作用: 作为上层协议提供一个传输数据的物理媒体;
+ 协议数据单元(PDU): eg: B it(比特);
+ 硬件代表: 网卡,网线,集线器,中继器以及调制解调器

#### 数据链路层

+ 数据链路层在不可靠的物理介质上提供可靠的传输
+ 该层的作用包括: 物理地址寻址、数据的成帧、流量控制、数据的检错、重发等
+ 协议数据单元: 帧Frame
+ 硬件代表: 网桥、交换机

#### 网络层

+ 这一层对端到端的包传输进行定义,定义了能够标识所有节点的逻辑地址,还定义了路由实现方式和学习方式.

+ 为了适应更大的传输单元长度小于包长度的传输介质, 网络层还定义了如何将一个包分解成更小的包的分段方法
+ 作用: 网络层负责对子网间的数据进行路由选择. 还可以实现拥塞控制、网络互联等功能
+ 协议数据单元: 数据包(Packet)
+ 硬件代表: 路由器

> 网络层通过寻址(寻址地址)来建立两个节点之间的连接, 我们的电脑连接上网络后都有一个IP地址,我们可以通过IP地址来确定不同的计算机是否在同一个子网路. 当我们的电脑连接上网络之后就有两种地址: 物理地址(MAC)和网络地址(IP),网络上的计算机要进行通信,必须要知道痛心的计算机“在哪里”,首先通过网络地址来判断是否处于同一个子网络,然后在对物理地址进行处理,从而来确定要通信计算机的位置.

#### 传输层

+ 通过网络层让我们建立主机与主机之间的通信,而传输层的功能就是建立在端口到端口的通信通道,这样就可以实现程序之间的数据通信.
+ 作用: 提供可靠和尽力而为的传输;
+ 协议数据单元: 段(Fragment)
+ 代表: 网关

> 通过Mac地址和IP地址,
>
> 我们找到互联网上任意两台计算机来建立通信. 然而这里有一个问题,那就是找到主机之后,主机上有很多程序都需要用到网络, 当网络上发送来一个数据包的时候, 程序之间不知道是哪一个程序来使用这个数据包,这是后悔我们就需要另外一个参数来确定,这个数据包到底是给谁的. 
>
> 这个参数就是端口号(port), 
>
> 规定只能选择0~65535之间的一个整数, 系统程序的端口0~1023, 用户自定义的端口只能选择大于1023的端口号

#### 回话层

+ 回话层定义课如何开始、控制和结束一个会话, 以便在只完成一个连续消息的一部分的时候可以通知应用,从而使白哦是层看到的数据都是连续的,在某些情况下,如果白哦是层收到了所有的数据,则用数据代表表示层. Eg: RPC,SQL等.
+ 作用:控制会话, 建立管理终止应用程序会话;
+ 协议数据单元: 会话协议数据单元SPDU
+ 代表: SSH、RPC(远程过程调用)、SQL、RTCP(实时传输控制协议)

#### 表示层:

+ 表示层定义了数据格式及加密. 例如: FTP允许你选择以二进制货哦这ASCII格式传输. 如果选择二进制, 那么发送大和接受方不改变文件内容. 如果哦选择ASII格式,发送方将文本Congo发送方的字符集转传成标准的ASCII后发送数据. 在接受方将标准的ASCII 转换成接收方计算机的字符集
+ 作用: 对数据提供加密、压缩、格式转换服务
+ 数据协议单元: 表示协议数据单元PPDU
+ 代表: ASCII、jpeg、mp3、wav、avi

#### 应用层

+ 应用层是模型中最顶层,是用户与网络的借口,该层通过应用程序来完成网络用户的应用需求. 该层的数据存放在TCP数据包的数据部分, 该层定义了一个很重要的协议-- http协议,一般的web开发都是基于应用层的开发
+ 作用: 控制应用程序,为应用程序提供网络服务
+ 协议数据单元: 应用协议数据单元APDU
+ 代表: Telnet、HTTP、FTP、SMTP

### 3. TCP/IP四层模型

TCP/IP协议簇是一个四层协议系统,可以是OSI模型的简化,结构图如下:

![8031371-fb5e1d74f6c2becd](https://i.loli.net/2021/09/14/Qvi8YebWq6T2IAZ.png)

#### 应用层

应用程序沟通的层,如简单的电子邮件(SMTP)、文件传输协议(FTP)、网络远程访问协议(Telnet)等.

#### 传输层

提供了节点之间的数据传输服务,如传输协议(TCP)、用户数据报协议(UDP)等,TCP和UDP给数据包传入传输数据并把它传输到下一层中,这一层负责传送数据,并且确定数据已被送达并接收

#### 网络层

负责提供基本的数据封包传送功能, 让每一块数据包都能够到达目的的主机(但是不检测是否被正确接收) eg:网际协议(IP)

#### 网络接口层

对实际的网络媒体的管理, 定义如何使用实际网络(如:ethernet,serial line等) 来传送数据

### 4. 数据解包和装包

![8031371-65ccfc65abf19f6b](https://i.loli.net/2021/09/14/y9WwNB253LJ81q7.png)

![8031371-9b5e1bb3de43f9f2](https://i.loli.net/2021/09/14/pYQbjnJCXE3ZsaG.png)

### 5. OSI七层协议各层次的代表协议

+ 物理层: RJ45 CLOCK IEEE802.3
+ 数据链路层: PPP FR HDLC VLAN MAC
+ 网络层: IP ICMP ARP RARP OSRF IPX RIP IGRP
+ 传输层: TCP UDP SPX
+ 回话层: NFS SQL NETBIOS RPC
+ 表示层: JPEG MPEG ASII MP4
+ 应用层: FTP DNS Telnet SMTP HTTP WWW NFS

### 6. TCP/IP协议介绍

> TCP、UDP、IP协议在此不介绍，另起文章细究

#### ICMP协议

+ ICMP协议,即因特网控制报文协议
+ 他是TCP/UDP协议簇的一个字协议,用于在IP主机、路由器之间传递控制消息
+ 数据网络层协议, ping命令就是ICMP协议的应用

#### NAT协议

+ 网络地址转换属接入广域网(WAN)技术,是一种将私有地址抓换位合法IP地址的转换技术
+ NAT将私有IP地址通过边界路由转换为外网IP地址,在边界路由的NAT地址转化表记录下这个转换映射记录,当外部数据返回时,路由使用NAT技术查询NAT转换表,再将目标地址转换为内网用户IP地址
+ NAT协议数据网络层协议

> 给予IPv4的IP地址只有32位,最多只有42.9亿个地址,还要去掉保留地址、组播地址,能用的地址只有36亿左右,但是当下IPv4还是主流,利用IPv4怎么满足这么多主机的IP地址呢?答案就是NAT,NAT技术工哦四、机构以及个人产生以及局域网,然后在各个局域网的边界WAN端口使用一个或多个公网的IPv4进行一对多转换

#### DHCP协议

+ 动态主机配置协议, DHCP(Dynamic Host Configuration Protocol)
+ 一种让系统得以连接到网络上,并获取欧需要的配置参数手段,基于UDP协议工作
+ 具体用途: 给内部网络或网络服务供应商自动分配IP地址,给用户或者内部网络管理员作为对所有计算机做中央管理的手段
+ DHCP协议属于网络层协议

> 一个主机如何获取IP地址? 有两种方式, 一种是静态配置,就是从网络管理员获取一个给定的IP地址,也叫硬编码,属于静态IP, 还有一种就是动态配置IP地址,也就是基于DHCP协议进行动态IP配置

#### ARP协议

+ 地址解析协议,即ARP(address resolution protocol), 是根据IP地址获取物理地址的一个TCP/IP协议

**工作流程**

1. 通过dns域名解析道主机的IP地址,应用程序发送请求通过TCP或者UDP使用得到IP建立连接
2. 当主机知道IP地址之后,并把数据报发过去的过程之前,主机在链路层实际上是要知道主机的物理地址的, 没太主机的物理地址是全球唯一的, 在这一步,就需要我们的ARP协议
3. 首先, 每一个主机都会在自得ARP缓冲区建立一个ARP列表,这个表示IP地址和Mac地址之间的对应关系
4. 当源主机要发送数据的时候,首先检查ARP列表当中是否有对应的IP地址的目的的主机的Mac地址, 如果有就直接发送数据,如果没有,就需要向网段的所有主机发送ARP数据包,这个数据包包括的内容有: 源主机的IP地址,Mac地址,以及目的主机的IP地址
5. 当本网络的所有主机收到这个ARP数据包的时候,首先检查数据包中的IP地址是否是自己的IP地址,如果不是就直接忽略,如果是,则首先从数据包中取出源主机的的IP地址和Mac地址,写入到ARP列表中,如果已经存在,就覆盖,然后和将从自己的Mac地址写入ARP响应包中,告诉源主机自己是他想要找到的Mac地址
6. 源主机收到ARP响应包之后. 将目的主机的IP和Mac地址写入ARP列表,并利用这个信息进行发送数据. 如果源主机一直没有收到ARP响应包,表示ARP查询失败. 广播发送ARP请求,单播发送ARP响应
7. 得到了目的主机物理地址之后, 就包含着IP数据报的以太网数据帧就可以正常发送了

#### RARP协议

+ RARP协议是逆地址解析协议,作用是完成Mac地址到IP地址的映射
+ 主要用于无盘工作站(没有磁盘驱动器的系统), 因为给无盘工作站配置的IP地址不能保存

**工作流程**

1. 在网络中配置一台RARP服务器, 里面保存着IP地址和Mac地址的映射关系
2. 当无盘工作站启动之后, 就封装一个RARP数据包,里面有其Mac地址,然后广播到网络上
3. 当服务器收到请求包之后, 就查找对应的Mac地址和IP地址装入响应报文中发回给请求者
4. 需要管请求报文,因此RARP只能用于具有广播能力的网络

#### FTP协议

+ 文件传输协议(File Transfer Protocol)是一种提供网络之间共享文件的协议, 它可以在计算机之间可靠、高效的传送文件. 在传输的时候,传输双方的操作系统、磁盘文件系统类型可以不同
+ FTP协议允许TCP/IP网络上的两台计算机进行文件传输.而FTP服务是基于FTP协议的文件传输服务
+ 工作时, 一台计算机上运行FTP客户端应用程序, 另一台计算机需要运行FTP服务器端恒旭. 只有拥有了FTP服务, 客户端才能进行文件传输

#### TFTP协议

+ TFTP协议, 即简单文件传输协议(Trivial File Transfer Protocol)
+ 该协议是TCP/IP协议族中一个用来在客户机与服务器之间进行简单文件传输的协议
+ 与FTP协议不同的是, TFTP传输文件的时候不需要用户进行登陆. 提供不复杂,开销不大的文件传输服务,它只能从父娶妻上下载或者上传文件,不能列出目录
+ 属于应用层的协议, TFTP基于UDP协议进行文件传输

#### HTTP协议

+ 超文本传输协议,是一个属于应用层的面向对象的协议,由于其简洁、快速的方式,适用于分布式超媒体信息系统
+ 基于TCP/IP协议实现

#### DNS协议

+ Domain Name System服务是和HTTP协议一样位于应用层分协议,它提供域名到IP地址之间的解析服务
+ 计算机既可以被赋予IP地址,也可以被赋予主机名和域名. 用户通常使用主机名和域名来访问对方的计算机,而不是直接通过IP地址访问. 因为IP地址是一组数字,不符合人类的记忆习惯
+ 为了解决上述的问题,DNS服务应运而生. DNS协议提供通过域名查找IP地址,或逆向从IP地址反查域名的服务

#### Telnet协议

+ Telnet协议是internet远程登录服务的标准协议和主要方式, 它为用户提供了在本地计算机上管理主机的能力
+ 使用者在自己的电脑上使用Telnet程序连接到服务器,然后再Telnet程序中输入命令,这些命令将会在服务器上运行,就像直接在服务器的控制台上输入一样

![8031371-ddd11e99258e64aa](https://i.loli.net/2021/09/15/YCNMKw3VhUuHWZ8.png)

#### SNMP协议

+ 简单网络管理协议(Simple Network Management Protocol)是由互联网工程任务组定义的一套网络管理协议. 这个协议是基于简单网关监视协议(Simple Gateway Monitor Protocol)指定的
+ Telnet协议可以用于连接远程计算机,并进行管理和控制,如远程执行命令, 这种情况下,执行的命令具有一定的局限性, 只能执行远程主机上支持的命令. 由于网络设备越来越多,网络规模越来越大,管理这些设备也变得越来越重要. 远程管理网络的需求日益迫切,SNMP应运而生
+ SNMP协议能够帮助网络管理员提高网络管理效率, 及时的发现和解决网络问题, 对网络增长做好规划. 网络管理员还可以通过SNMP协议,接收网络节点的通知消息和警告事件报告等, 从而获取网络出现的问题

工作流程如图所示:

![8031371-23f62a7ede25b256](https://i.loli.net/2021/09/15/YC5TX2rzvsdqhKc.png)

上图中展示了管理员通过NMS获取网关监控数据的工作流程,其中涉及到了一些SNMP协议的关键信息

为了方便理解,下面先介绍这些信息的作用以及含义:

**MIB(管理信息库)**

任何一个被管理的设备都表示成一个对象,并称之为被管理的对象. 而MIB就是被管理对象的集合. 他定义了被管理对象的一系列属性,如对象的名称、对象的访问权限和对象的恶数据类型等. 每个设别都有自己的MIB. MIB是一种树状数据库,MIB管理的对象,就是树的端节点,每个节点都有唯一的位置和唯一的名字

**SNMP代理:**

是一种嵌入在管理设备中的网络管理软件模块, 主要用来控制本地机器的管理信息. 他还负责将管理信息转换成SNMP兼容的格式,传递给NMS